# Videos Cleaner

## Описание

Videos Cleaner — это CLI-инструмент для очистки и синхронизации базы видео на платформе EDM SU. Приложение проверяет наличие исходных видео на YouTube и автоматически управляет статусом видео в локальной базе: восстанавливает, скрывает или удаляет видео в зависимости от доступности на YouTube. Это помогает поддерживать актуальность контента, удаляя или архивируя недоступные видео.

## Установка

1. Клонируйте репозиторий:
   ```
   git clone https://github.com/yourusername/videos-cleaner.git
   cd videos-cleaner
   ```

2. Установите зависимости с помощью uv (или pip):
   ```
   uv sync
   # или
   pip install -e .
   ```

3. Убедитесь, что установлен Python 3.13+.

## Запуск через Docker

   ```
   docker run --rm ghcr.io/edm-su/videos-cleaner:latest --main-api-url https://api.edm.su --limit 500
   ```

   - Передавайте аргументы CLI как параметры после имени образа.

## Использование

Запустите команду для очистки видео:

```
cleaner --main-api-url https://api.edm.su --limit 500
```

- `--main-api-url`: URL API для работы с видео (по умолчанию: http://localhost).
- `--limit`: Количество видео для проверки (по умолчанию: 500; 0 — все видео).

Пример вывода:
```
Обработано: 123 видео.
Скрыто: 10.
Удалено навсегда: 5.
Восстановлено: 3.
```

Если limit=0, обрабатываются все видео. Обработка происходит батчами по 50 видео для эффективности.

## Функции

- Получение списка видео из API (включая удалённые).
- Проверка существования видео на YouTube через oEmbed API.
- Автоматическое восстановление удалённых видео, если они существуют на YouTube.
- Скрытие (временное удаление) или полное удаление видео, если они недоступны на YouTube (скрыты или удалены).
- Вывод статистики обработки.

## Структура проекта

- `src/videos_cleaner/`: Основной код.
  - `entities/`: Модели (Video, VideoCleanerStats).
  - `domain/`: Use cases и интерфейсы репозиториев.
  - `adapters/`: Реализации репозиториев (HTTP-клиенты для API).
  - `controller/`: CLI-интерфейс.
- `tests/`: Тесты.
- `pyproject.toml`: Зависимости и конфигурация.

## Требования

- Python >= 3.13
- Доступ к YouTube

## Разработка

- Линтинг: `uv run ruff check .`
- Тесты: `uv run pytest`
- Покрытие: `uv run pytest --cov`

## Лицензия

MIT
